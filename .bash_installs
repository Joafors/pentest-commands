#!/bin/bash

CURR_SHELL="bash"
RC_FILE=".$CURR_SHELL"rc
WHO_AM_I=$(whoami)
RC_FILE_LOCATION="/home/$WHO_AM_I"

echo -e "\033[1;32m[+]\033[0m The current shell is $CURR_SHELL"

# aliases to be added to the rc file
alias_array=(
"alias common=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/common)\\\"\""
"alias active=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/active)\\\"\""
"alias passive=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/passive)\\\"\""
"alias revshells=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/revshells)\\\"\""
"alias linhold=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/linux/linhold)\\\"\""
"alias ttys=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/linux/ttys)\\\"\""
"alias linesc=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/linux/linesc)\\\"\""
"alias kernsploit=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/linux/kernsploit)\\\"\""
"alias lintran=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/linux/lintran)\\\"\""
"alias lintun=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/linux/lintun)\\\"\""
"alias wintran=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/windows/wintran)\\\"\""
"alias winhold=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/windows/winhold)\\\"\""
"alias powercom=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/windows/powercom)\\\"\""
"alias brutecom=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/tools/brutecom)\\\"\""
"alias mailcom=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/services/mailcom)\\\"\""
"alias ficom=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/webapp/ficom)\\\"\""
"alias sqlicom=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/webapp/sqlicom)\\\"\""
"alias fuzzcom=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/webapp/fuzzcom)\\\"\""
"alias nmapcom=\"printf '%b' \\\"\\\$(cat ~/pentest-commands/commands/tools/nmapcom)\\\"\""
"alias commands=\"/usr/bin/python3 ~/pentest-commands/helper/guide.py\""
)


file_path="$RC_FILE_LOCATION/$RC_FILE"

# check if rc file exists, if it doesn't add, else ignore.
if [ -e "$file_path" ]; then
    printf '%b' "\033[1;32m[+]\033[0m rc file exists, continueing.\n"
else
    printf '%b' "\033[1;31m[-]\033[0m rc file does not exist, adding it.\n"
    touch "$file_path"
fi

echo -e "\033[1;33m[!]\033[0m Creating a backup of existing $RC_FILE"
cp "$file_path" "$file_path.bak"

if [ -e "$file_path" ]; then
    printf '%b' "\33[1;33m[!] \033[0mRC_PATH: $file_path\n"
    tmp_file="tmpfile"

    for element in "${alias_array[@]}"; do
        if ! grep -qF "$element" "$file_path"; then
            echo -e "\033[1;32m[+]\033[0m Prepending $element to $file_path"
            echo "$element" | cat - "$file_path" > "$tmp_file"
            mv "$tmp_file" "$file_path"
        else
            echo -e "\033[1;33m[!]\033[0m A line already exists in $file_path, skipping."
        fi
    done

    echo -e "\033[1;32m[+]\033[0m Sourcing the updated file $file_path"
    . "$file_path"

    echo -e "\033[1;33m[!]\033[0m If you still can't use the aliases you might need to open a new terminal"
else
    echo -e "\033[1;35m[!]\033[0m The file you're trying to append to does not exist!"
    exit
fi
